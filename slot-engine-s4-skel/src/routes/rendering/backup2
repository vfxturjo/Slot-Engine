<script lang="ts">
	import Matter from 'matter-js';
	import { fabric } from 'fabric';
	import { onMount } from 'svelte';

	// module aliases
	let Engine = Matter.Engine,
		Render = Matter.Render,
		Runner = Matter.Runner,
		Bodies = Matter.Bodies,
		Composite = Matter.Composite;

	let canvas: HTMLCanvasElement;
	let engine: Matter.Engine;
	let world;
	let fabricCanvas;

	onMount(() => {
		// Set up Matter.js
		engine = Engine.create();
		world = engine.world;

		// create a renderer
		let render = Render.create({
			element: canvas,
			engine: engine
		});

		// create two boxes and a ground
		let boxA = Bodies.rectangle(400, 200, 80, 80);
		let boxB = Bodies.rectangle(450, 50, 80, 80);
		let ground = Bodies.rectangle(400, 610, 810, 60, { isStatic: true });

		// add all of the bodies to the world
		Composite.add(world, [boxA, boxB, ground]);
		// add all of the bodies to the world

		// run the renderer
		Render.run(render);
		// create runner
		var runner = Runner.create();
		// run the engine
		Runner.run(runner, engine);
	});

	function addNewCircle() {
		const radius = 20 + Math.random() * 30;
		const circle = Matter.Bodies.circle(Math.random() * 700 + 50, 50, radius, {
			restitution: 0.5,
			label: 'Circle',
			render: {
				fillStyle: `rgb(${Math.random() * 255},${Math.random() * 255},${Math.random() * 255})`
			}
		});
		Matter.World.add(world, circle);
	}
</script>

<canvas bind:this={canvas} class="size-full"></canvas>
<button on:click={addNewCircle}>Add new circle</button>

<style>
	canvas {
		border: 1px solid black;
	}
	button {
		margin-top: 10px;
	}
</style>
